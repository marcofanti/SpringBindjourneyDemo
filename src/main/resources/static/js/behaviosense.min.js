"use strict";function integrityData(e,t){for(var n=document.getElementsByTagName("input"),a=[],i=0;i<n.length;i++)if("undefined"!=typeof $(n[i]).attr("monitored")&&"hidden"!=n[i].type&&"button"!=n[i].type&&"submit"!=n[i].type&&"radio"!==n[i].type&&"checkbox"!==n[i].type){var o=n[i].type+"#"+n[i].name,r=n[i].value.length,s={};s[o]=r,a.push(s)}for(var i=0;i<e.behavioData.length;++i)if("c"==e.behavioData[i][0]){var d="movement",h=0,u={};u[d]=h,a.push(u);break}e.behavioData.push(["w",a,t])}function readyState(e){"interactive"!=document.readyState&&"complete"!=document.readyState||e()}var Monitor=function(){this.init()};Monitor.prototype={collectorEndpoint:bhw_ajax_endpoint,isOpera:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome&&!this.isOpera,isIE9:/(MSIE 9.0)/g.test(navigator.userAgent),isIE10:navigator.userAgent.toString().toLowerCase().indexOf("trident/6")>-1,isIE11:!window.ActiveXObject&&"ActiveXObject"in window,isIE:/(MSIE)/g.test(navigator.userAgent),isIOS:/(iPad|iPhone|iPod)/g.test(navigator.userAgent),behavioData:[],anonMap:[],startTime:(new Date).getTime(),lastViewport:[-1,-1],lastTarget:null,capture:!0,hasSent:!1,behavio_hidden:null,behavio_hidden_id:"behavio_hidden",ignoreFields:[],haveMouse:!1,lastKey:-1,textLength:{},behavioweb_config:{anonymous:{by_name:[],by_id:[],by_type:["password"]}},bindListeners:!1,isAndroid:/android (\d+)/i.test(window.navigator.userAgent),isFirefox:/firefox/i.test(window.navigator.userAgent),hasFallbackListeners:!1,init:function(){var e;e=setInterval(function(){"complete"==document.readyState&&(bw.startMonitor(),this.initialized=!0,clearInterval(e))},10)},createCORSRequest:function(e,t,n,a){n=!1;var i=new XMLHttpRequest;return"withCredentials"in i?(i.open(e,t,n),bw.isIE&&!n&&(i.timeout=bw.syncTimeout),i.setRequestHeader("Content-Type","text/plain"),i.onload=function(e){4===i.readyState&&a(200===i.status?i:i)}):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t,n),n||(i.timeout=bw.syncTimeout)):i="undefined"!=typeof ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,null!==i&&"undefined"!=typeof i.setRequestHeader&&i.setRequestHeader("Content-Type","text/plain"),i},prepHttpStr:function(e){var t="";return""!==e.data.journeyid&&"undefined"!=typeof e.data.journeyid&&(t+="journeyid="+encodeURIComponent(e.data.journeyid)),""!==e.data.sessionid&&"undefined"!=typeof e.data.sessionid&&(t+="&sessionid="+encodeURIComponent(e.data.sessionid)),""!==e.data.userid&&"undefined"!=typeof e.data.userid&&(t+="&userid="+encodeURIComponent(e.data.userid)),""!==e.data.notes&&"undefined"!=typeof e.data.notes&&(t+="&notes="+encodeURIComponent(e.data.notes)),"undefined"!=typeof e.data.behavioData&&(t+="&data="+encodeURIComponent(JSON.stringify(e.data.behavioData))),t},ajax:function(e){var t,n=bw.collectorEndpoint;e.type;t=e.async;var a=bw.createCORSRequest("post",n,t,e.callback);bw.httpStr=bw.prepHttpStr(e),setTimeout(function(){a.send(bw.httpStr)},0)},submitHandler:function(e){document.getElementById(bw.behavio_hidden_id).value=JSON.stringify(bw.behavioData,"","")},getBehavioData:function(e){var t=JSON.stringify(bw.behavioData,"","");return e&&(bw.behavioData=[],bw.startMonitor(!1)),t},resetBehavioData:function(){return bw.behavioData=[],bw.startMonitor(!1),bw.hasSent=!1,!0},sendData:function(e,t,n,a,i){if(bw.hasSent)return!0;bw.hasSent=!0;var o=window.location.pathname.split("?")[0];integrityData(bw,o);var r={journeyid:e,sessionid:t,userid:n,notes:a,behavioData:bw.behavioData};bw.ajax({type:"post",url:bw.collectorEndpoint,async:!0,data:r,callback:i})},addKeyEvent:function(e,t,n){var a,i;for(a=this.behavioData.length-1;a>=-1;a--){if(-1==a){null==this.behavioData[0]?(this.behavioData[0]=[],"a"==t?this.behavioData[0][0]="fa":"n"==t&&(this.behavioData[0][0]="f"),this.behavioData[0][1]=e,this.behavioData[0][2]=[],this.behavioData[0][2][0]=n):(i=this.behavioData.length,this.behavioData[i]=[],"a"==t?this.behavioData[i][0]="fa":"n"==t&&(this.behavioData[i][0]="f"),this.behavioData[i][1]=e,this.behavioData[i][2]=[],this.behavioData[i][2][0]=n);break}if("a"==t){if("fa"!==this.behavioData[a][0])continue}else if("n"==t&&"f"!==this.behavioData[a][0])continue;if(this.behavioData[a][1]==e){this.behavioData[a][2][this.behavioData[a][2].length]=n;break}}},addEvent:function(e,t){var n,a;for(n=this.behavioData.length-1;n>=-1;n--){if(-1==n){null==this.behavioData[0]?(this.behavioData[0]=[],this.behavioData[0][0]="c",this.behavioData[0][1]=[],this.behavioData[0][1][0]=e,this.behavioData[0][2]=window.location.pathname.split("?")[0]):(a=this.behavioData.length,this.behavioData[a]=[],this.behavioData[a][0]="c",this.behavioData[a][1]=[],this.behavioData[a][1][0]=e,this.behavioData[a][2]=window.location.pathname.split("?")[0]);break}if("c"==this.behavioData[n][0]){this.behavioData[n][1][this.behavioData[n][1].length]=e;break}}},getTimestamp:function(){var e=new Date;return e.getTime()-this.startTime},checkTarget:function(e){var t=document.elementFromPoint(e.clientX,e.clientY),n=[];null!=t&&t!=this.lastTarget&&"undefined"!=typeof t&&"undefined"!=typeof t.parentNode&&(n[0]="t",n[1]=t.nodeName+"#"+t.id+"#"+t.parentNode.nodeName+"#"+t.parentNode.id,n[2]=bw.getTimestamp(),this.lastTarget=t,bw.addEvent(n))},checkViewport:function(){if(this.lastViewport[0]!==document.documentElement.clientWidth||this.lastViewport[1]!==document.documentElement.clientHeight){var e=[];e[0]="v",e[1]=document.documentElement.clientWidth,e[2]=document.documentElement.clientHeight,e[3]=bw.getTimestamp(),this.lastViewport[0]=document.documentElement.clientWidth,this.lastViewport[1]=document.documentElement.clientHeight,bw.addEvent(e)}},mouseMoveHandler:function(e){var t=[];t[0]="mm",t[1]=e.clientX,t[2]=e.clientY,t[3]=bw.getTimestamp(),bw.checkTarget(e),bw.checkViewport(),bw.addEvent(t)},mouseDownHandler:function(e){var t=[];t[0]="md",t[1]=e.clientX,t[2]=e.clientY,t[3]=bw.getTimestamp(),t[4]=e.button,bw.checkTarget(e),bw.checkViewport(),bw.addEvent(t)},mouseUpHandler:function(e){var t=[];t[0]="mu",t[1]=e.clientX,t[2]=e.clientY,t[3]=bw.getTimestamp(),t[4]=e.button,bw.checkTarget(e),bw.checkViewport(),bw.addEvent(t)},keyHandler:function(e){var t,n=[],a=0==e.keyCode?229:e.keyCode,i=a,o=null,r=e.currentTarget?e.currentTarget:e.srcElement,s="n",d=0;229!=a||"keydown"!=e.type||bw.isFirefox||bw.hasFallbackListeners||(bw.fallbackListeners(),bw.hasFallbackListeners=!0);var o=r.type+"#"+r.name;if(null==a&&(a=-500,i=-500),"a"!==s){for(t=0;t<bw.behavioweb_config.anonymous.by_id.length&&"a"!==s;t++)bw.behavioweb_config.anonymous.by_id[t]==r.id&&(s="a");for(t=0;t<bw.behavioweb_config.anonymous.by_name.length&&"a"!==s;t++)bw.behavioweb_config.anonymous.by_name[t]==r.name&&(s="a");for(t=0;t<bw.behavioweb_config.anonymous.by_type.length&&"a"!==s;t++)bw.behavioweb_config.anonymous.by_type[t]==r.type&&(s="a")}if("a"==s){if(9==a||13==a)return;if(document.selection){r.focus();var h=document.selection.createRange(),u=document.selection.createRange().text.length;h.moveStart("character",-r.value.length),d=h.text.length-u}else(r.selectionStart||"0"==r.selectionStart)&&(d=r.selectionStart);8==a?"keydown"==e.type?(null==bw.anonMap[a]&&(bw.anonMap[a]=d),n[0]=-1,n[1]=d):"keyup"==e.type&&(n[0]=-2,n[1]=bw.anonMap[a],bw.anonMap[a]=null):46==a?"keydown"==e.type?(null==bw.anonMap[a]&&(bw.anonMap[a]=d),n[0]=-3,n[1]=d):"keyup"==e.type&&(n[0]=-4,n[1]=bw.anonMap[a],bw.anonMap[a]=null):"keydown"==e.type?(null==bw.anonMap[a]&&(bw.anonMap[a]=d),n[0]=0,n[1]=d):"keyup"==e.type&&(n[0]=1,n[1]=bw.anonMap[a],bw.anonMap[a]=null)}else{if(229==a&&"keydown"==e.type)bw.setTextLength(o,r.value.length);else if(229==a&&"keyup"==e.type){var c=bw.textLength[o]||[],l=r.value.length,b=c.pop()||0;if(-1!=bw.lastKey||b>l){1>=l-b&&(i=b>l?8:bw.lastKey);var f=bw.getTargetData(o),p=f[f.length-1];229==p[1]&&(p[1]=i),bw.lastKey=-1}}"keyup"==e.type?(n[0]=1,n[1]=i):"keydown"==e.type&&(n[0]=0,n[1]=i)}n[2]=bw.getTimestamp(),null!=n[1]&&bw.addKeyEvent(o,s,n)},getTargetData:function(e){for(var t=this.behavioData.length-1;t>=0;t--)if(this.behavioData[t][1]==e)return this.behavioData[t][2]},setLastKey:function(e){bw.lastKey=e},setTextLength:function(e,t){(bw.textLength[e]=bw.textLength[e]||[]).push(t)},keyTransformer:function(e){e.data&&1==e.data.length&&bw.setLastKey(e.data.toUpperCase().charCodeAt(0))},keyComposition:function(e){e.data&&bw.setLastKey(e.data.toUpperCase().charCodeAt(e.data.length-1))},monitorField:function(e){if(e.length)for(var t=0;t<e.length;t++)this.monitorField(e[t]);else e.addEventListener?(e.addEventListener("keydown",this.keyHandler,!1),e.addEventListener("keyup",this.keyHandler,!1),this.isAndroid&&!this.isFirefox&&this.fallbackListeners(e)):e.attachEvent&&(e.attachEvent("onkeydown",this.keyHandler),e.attachEvent("onkeyup",this.keyHandler))},removeListener:function(e){if(e.length)for(var t=0;t<e.length;t++)this.removeListener(e[t]);else{for(var n=e.type+"#"+e.name,t=this.behavioData.length-1;t>=0;t--)if(this.behavioData[t][1]==n){this.behavioData.splice(t,1);break}e.addEventListener?(e.removeEventListener("keydown",this.keyHandler,!1),e.removeEventListener("keyup",this.keyHandler,!1),this.isAndroid&&!this.isFirefox&&this.removeFallbackListeners(e)):e.attachEvent&&(e.detachEvent("onkeydown",this.keyHandler),e.detachEvent("onkeyup",this.keyHandler))}},fallbackListeners:function(e){e&&e.addEventListener?(e.addEventListener("textInput",this.keyTransformer,!1),e.addEventListener("compositionupdate",this.keyComposition,!1)):document.addEventListener&&(document.addEventListener("textInput",this.keyTransformer,!1),document.addEventListener("compositionupdate",this.keyComposition,!1))},removeFallbackListeners:function(e){e&&e.addEventListener?(e.removeEventListener("textInput",this.keyTransformer,!1),e.removeEventListener("compositionupdate",this.keyComposition,!1)):document.addEventListener&&(document.removeEventListener("textInput",this.keyTransformer,!1),document.removeEventListener("compositionupdate",this.keyComposition,!1))},startMonitor:function(e){if(!e&&this.bindListeners){var t,n,a,i,o,r=document.getElementsByTagName("form");for(t=0;t<r.length;t++){for(a=r[t],"undefined"!=typeof jQuery?jQuery("form").submit(bw.submitHandler):a.addEventListener?a.addEventListener("submit",bw.submitHandler,!1):a.attachEvent&&a.attachEvent("onsubmit",bw.submitHandler),i=a.getElementsByTagName("textarea"),n=0;n<i.length;n++)o=i[n],-1===this.ignoreFields.indexOf(o.name)&&this.monitorField(o);for(i=a.getElementsByTagName("input"),n=0;n<i.length;n++)o=i[n],"checkbox"!==o.type&&"radio"!==o.type&&-1===this.ignoreFields.indexOf(o.name)&&this.monitorField(o)}}this.haveMouse===!0&&(document.addEventListener?(document.addEventListener("mousedown",this.mouseDownHandler,!1),document.addEventListener("mouseup",this.mouseUpHandler,!1),document.addEventListener("mousemove",this.mouseMoveHandler,!1)):document.attachEvent&&(document.attachEvent("onmousedown",this.mouseDownHandler),document.attachEvent("onmouseup",this.mouseUpHandler),document.attachEvent("onmousemove",this.mouseMoveHandler))),this.isAndroid&&(this.hasFallbackListeners=!0);var s={};for(t in navigator)s[t]=navigator[t];delete s.plugins,delete s.mimeTypes;var d={};for(t in screen)d[t]=screen[t];this._navigator=s,this._screen=d,this.behavioData[0]=["m","n",s],this.behavioData[1]=["m","s",d],this.behavioData[2]=["m","v",250]}};var bw=new Monitor;"undefined"==typeof console&&(this.console={log:function(){},info:function(){},error:function(){},warn:function(){}}),Date.now=Date.now||function(){return+new Date};var JSON;JSON||(JSON={}),function(){function d(e){return 10>e?"0"+e:e}function b(e){return a.lastIndex=0,a.test(e)?'"'+e.replace(a,function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function g(a,i){var o,r,s,d,h,u=e,c=i[a];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(a)),"function"==typeof n&&(c=n.call(i,a,c)),typeof c){case"string":return b(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(e+=t,h=[],"[object Array]"==Object.prototype.toString.apply(c)){for(d=c.length,o=0;d>o;o+=1)h[o]=g(o,c)||"null";return s=0==h.length?"[]":e?"[\n"+e+h.join(",\n"+e)+"\n"+u+"]":"["+h.join(",")+"]",e=u,s}if(n&&"object"==typeof n)for(d=n.length,o=0;d>o;o+=1)"string"==typeof n[o]&&(r=n[o],s=g(r,c),s&&h.push(b(r)+(e?": ":":")+s));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(s=g(r,c),s&&h.push(b(r)+(e?": ":":")+s));return s=0==h.length?"{}":e?"{\n"+e+h.join(",\n"+e)+"\n"+u+"}":"{"+h.join(",")+"}",e=u,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var e,t,n,a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,i,o){var r;if(e="",t="","number"==typeof o)for(r=0;o>r;r+=1)t+=" ";else"string"==typeof o&&(t=o);if(n=i,i&&"function"!=typeof i&&("object"!=typeof i||"number"!=typeof i.length))throw new Error("JSON.stringify");return g("",{"":a})})}(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n,a;for(n=t||0,a=this.length;a>n;n++)if(this[n]===e)return n;return-1});